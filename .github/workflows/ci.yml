name: Kidon CI Pipeline

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.24'

      - name: Install eBPF Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y clang llvm libbpf-dev linux-headers-generic gcc-multilib

      - name: Generate eBPF Artifacts
        run: go generate ./internal/runtime/... || echo "eBPF generation skipped (requires Linux kernel headers)"

      - name: Build Binary
        run: go build -v -o kidon cmd/kidon/main.go

      - name: Run Static Scanner
        run: ./kidon scan . || true

      - name: Verify Commands
        run: |
          ./kidon --version
          ./kidon scan --help
          ./kidon guard --help
          ./kidon strike --help
          ./kidon report --help
          ./kidon dashboard --help
